<section id="baseboard-design-reference-document" class="cell markdown">
<h1>Baseboard Design Reference Document</h1>
<p>The baseboard module contains all the signal and power IO for the
effects module. Input voltage of 9V DC is regulated to +/- 9V to drive
an analog switch and the effects board and to +3.3V to drive the LED
indicators and footswitches. A 16-bit microcontroller manages the
switching logic, interfaces with peripherals, and supervises the power
supply circuit. The audio input and output are routed to the effects
board via the switching circuitry through a flat flex cable.</p>
<p>[BLOCK DIAGRAM]</p>
<p>In order to generate plots and perform design analysis, libraries
must be imported below:</p>
</section>
<div class="cell code">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># iec16022 for qr codes</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;refdoc.mplstyle&#39;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> EngFormatter</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define formatter for frequency</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>formatter_Hz <span class="op">=</span> EngFormatter(unit<span class="op">=</span><span class="st">&#39;Hz&#39;</span>, sep<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># define formatter for time</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>formatter_s <span class="op">=</span> EngFormatter(unit<span class="op">=</span><span class="st">&#39;s&#39;</span>, sep<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># define formatter for resistance</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>formatter_Ohm <span class="op">=</span> EngFormatter(unit<span class="op">=</span><span class="st">&#39;Ω&#39;</span>, sep<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#define formatter for dBV</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>formatter_dBV <span class="op">=</span> EngFormatter(unit<span class="op">=</span><span class="st">&#39;dBV&#39;</span>, sep<span class="op">=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
</div>
<section id="specifications" class="cell markdown">
<h3>Specifications</h3>
<ol>
<li>Power
<ol>
<li>The Baseboard shall provide a ± 9V, ± 1% power supply capable of
sourcing ± 200mA peak to the audio effects board</li>
<li>The Baseboard shall provide low-voltage power circuitry capable of
operation from +1.2V, ± 1% to +5V, ± 1%</li>
<li>The Baseboard shall be capable of sourcing 150mA peak to drive local
peripherals</li>
<li>Noise from any power supply must be below -40dB at all frequencies
and below -60dB above 100Hz</li>
</ol></li>
<li>Input/Output
<ol>
<li>The Baseboard shall route the audio signal to the baseboard while
providing a true bypass path directly to the output</li>
<li>The Baseboard shall provide input impedance of 1MΩ ± 1% and output
impedance of 49.9kΩ ± 1%</li>
<li>Input Filter</li>
<li>Output Filter</li>
</ol></li>
<li>Switching
<ol>
<li>The audio signal shall be switched using high quality analog
switches to maximize durability and signal integrity</li>
<li>The switches shall have an impedance of no greater than 500Ω to
minimize impedance matching losses</li>
</ol></li>
</ol>
</section>
<section id="output-power-noise" class="cell markdown">
<h4>Output Power Noise</h4>
</section>
<div class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>min_freq <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>max_freq <span class="op">=</span> <span class="fl">100E6</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>frequency <span class="op">=</span> np.logspace(np.log10(min_freq), np.log10(max_freq), <span class="dv">30000</span>, base<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>noise_spec_9V <span class="op">=</span> []</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>noise_spec_LV <span class="op">=</span> []</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>corner_freq_9V <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>corner_freq_LV <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> freq <span class="kw">in</span> frequency:</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> freq <span class="op">&lt;</span> corner_freq_9V:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        noise_spec_9V.append(<span class="op">-</span><span class="dv">40</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        noise_spec_9V.append(<span class="op">-</span><span class="dv">60</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> freq <span class="op">&lt;</span> corner_freq_LV:</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        noise_spec_LV.append(<span class="op">-</span><span class="dv">30</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        noise_spec_LV.append(<span class="op">-</span><span class="dv">55</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>ax.plot(frequency, noise_spec_9V, label<span class="op">=</span><span class="st">&#39;±9V Supply&#39;</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>ax.plot(frequency, noise_spec_LV,label<span class="op">=</span><span class="st">&#39;+3.3V Supply&#39;</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>ax.set_xscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(formatter_Hz)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(formatter_dBV)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="dv">100</span>, <span class="dv">0</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Voltage Noise&quot;</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">&quot;Power Supply Output Noise Limit&quot;</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="output display_data">
<p><img src="7b5e728101c9dcec9dfbfecc1cb02200040945bc.png" /></p>
</div>
</div>
<section id="system-block-diagram" class="cell markdown">
<h2>System Block Diagram</h2>
</section>
<section id="circuit-design" class="cell markdown">
<h2>Circuit Design</h2>
<p>Overview</p>
</section>
<section id="power" class="cell markdown">
<h3>Power</h3>
<p>ADP5070 Datasheet: <a
href="https://www.analog.com/media/en/technical-documentation/data-sheets/ADP5070.pdf"
class="uri">https://www.analog.com/media/en/technical-documentation/data-sheets/ADP5070.pdf</a></p>
</section>
<div class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>I_OUT1 <span class="op">=</span> <span class="fl">200E-3</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>I_OUT2 <span class="op">=</span> <span class="op">-</span><span class="fl">200E-3</span></span></code></pre></div>
</div>
<section id="feedback-resistors" class="cell markdown">
<h4>Feedback Resistors</h4>
<p>To select the appropriate feedback resistors, the following
relationships were taken from the datasheet to compute the correct
values.</p>
<p>The positive output for the boost regulator can be set using the
relationship</p>
<p><span class="math display">$$ V_{POS} = V_{FB1} \left( 1 +
\frac{R_{FT1}}{R_{FB1}} \right) $$</span></p>
<p>where <span
class="math inline"><em>V</em><sub><em>P</em><em>O</em><em>S</em></sub></span>
is the positive output voltage, <span
class="math inline"><em>V</em><sub><em>F</em><em>B</em>1</sub></span> is
the <span class="math inline"><em>F</em><em>B</em>1</span> reference
voltage, <span
class="math inline"><em>R</em><sub><em>F</em><em>T</em>1</sub></span> is
the feedback resistor from <span
class="math inline"><em>V</em><sub><em>P</em><em>O</em><em>S</em></sub></span>
to <span class="math inline"><em>F</em><em>B</em>1</span>, and <span
class="math inline"><em>R</em><sub><em>F</em><em>B</em>1</sub></span> is
the feedback resistor from <span
class="math inline"><em>F</em><em>B</em>1</span> to <span
class="math inline"><em>A</em><em>G</em><em>N</em><em>D</em></span>.</p>
<p>The negative output for the inverting regulator can be set using the
relationship</p>
<p><span class="math display">$$ V_{NEG} = V_{FB2} -
\frac{R_{FT2}}{R_{FB2}} \left( V_{REF} - V_{FB2} \right) $$</span></p>
<p>where <span
class="math inline"><em>V</em><sub><em>N</em><em>E</em><em>G</em></sub></span>
is the negative output voltage, <span
class="math inline"><em>V</em><sub><em>F</em><em>B</em>2</sub></span> is
the <span class="math inline"><em>F</em><em>B</em>2</span> reference
voltage, <span
class="math inline"><em>R</em><sub><em>F</em><em>T</em>2</sub></span> is
the feedback resistor from <span
class="math inline"><em>V</em><sub><em>N</em><em>E</em><em>G</em></sub></span>
to <span class="math inline"><em>F</em><em>B</em>2</span>, <span
class="math inline"><em>R</em><sub><em>F</em><em>B</em>2</sub></span> is
the feedback resistor from <span
class="math inline"><em>F</em><em>B</em>2</span> to <span
class="math inline"><em>V</em><sub><em>R</em><em>E</em><em>F</em></sub></span>,
and <span
class="math inline"><em>V</em><sub><em>R</em><em>E</em><em>F</em></sub></span>
is the <span
class="math inline"><em>V</em><sub><em>R</em><em>E</em><em>F</em></sub></span>
pin reference voltage.</p>
<p>Recommended values can also be selected from the table below, from
the manufacturer's datasheet.</p>
<p><img src="ADP5070_fb_resistor_chart.png"
alt="ADP5070_fb_resistor_chart.png" /></p>
<p>In order to have the correct margin to allow for the linear regulator
drop-out voltage, output voltages of <span
class="math inline"> ± 12<em>V</em></span> were selected, yielding the
following values for the feedback resistors as taken from the table.</p>
<p><span
class="math display"><em>R</em><sub><em>F</em><em>T</em>1</sub> = 1.4<em>M</em><em>Ω</em></span>
<span
class="math display"><em>R</em><sub><em>F</em><em>B</em>1</sub> = 100<em>k</em><em>Ω</em></span>
<span
class="math display"><em>R</em><sub><em>F</em><em>T</em>2</sub> = 1.15<em>M</em><em>Ω</em></span>
<span
class="math display"><em>R</em><sub><em>F</em><em>B</em>2</sub> = 71.5<em>k</em><em>Ω</em></span></p>
<p>The low-noise precision resistors chosen for the design do not
support values above <span
class="math inline">1<em>M</em><em>Ω</em></span>, so these ratios must
be reconfigured to have the largest value resistor be <span
class="math inline">1<em>M</em><em>Ω</em></span>. The relationships
above can be rewritten to solve for the other resistor value.</p>
<p><span class="math display">$$ R_{FB1} =
\frac{R_{FT1}}{\frac{V_{POS}}{V_{FB1}}-1} $$</span></p>
<p><span class="math display">$$ R_{FB2} = R_{FT2}\frac{V_{REF} -
V_{FB2}}{V_{FB2}-V_{NEG}} $$</span></p>
</section>
<div class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>V_POS <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>V_NEG <span class="op">=</span> <span class="op">-</span><span class="dv">12</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>V_IN <span class="op">=</span> <span class="fl">8.55</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>V_FB1 <span class="op">=</span> <span class="fl">0.8</span> <span class="co"># from datasheet page 3</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>V_FB2 <span class="op">=</span> <span class="fl">0.8</span> <span class="co"># from datasheet page 4</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>V_REF <span class="op">=</span> <span class="fl">1.6</span> <span class="co"># from datasheet page 4</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>R_FT1 <span class="op">=</span> <span class="fl">1E6</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>R_FT2 <span class="op">=</span> <span class="fl">1E6</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>R_FB1 <span class="op">=</span> R_FT1 <span class="op">/</span> ( (V_POS <span class="op">/</span> V_FB1) <span class="op">-</span> <span class="dv">1</span> )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>R_FB2 <span class="op">=</span> R_FT2 <span class="op">*</span> (V_REF <span class="op">-</span> V_FB2) <span class="op">/</span> (V_FB2 <span class="op">-</span> V_NEG)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R_FT1 = </span><span class="sc">{</span>R_FT1<span class="sc">}</span><span class="ss"> Ω&quot;</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R_FB1 = </span><span class="sc">{</span>R_FB1<span class="sc">}</span><span class="ss"> Ω&quot;</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R_FT2 = </span><span class="sc">{</span>R_FT2<span class="sc">}</span><span class="ss"> Ω&quot;</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R_FB2 = </span><span class="sc">{</span>R_FB2<span class="sc">}</span><span class="ss"> Ω&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R_FT1 = 1000000.0 Ω
R_FB1 = 71428.57142857143 Ω
R_FT2 = 1000000.0 Ω
R_FB2 = 62500.0 Ω
</code></pre>
</div>
</div>
<section id="output-capacitors" class="cell markdown">
<h4>Output Capacitors</h4>
<p>The capacitor dielectric is chosen to be X5R or X7R to provide
adequate temperature and DC bias characteristics. The worst-case
capacitance considering temperature variation, tolerance, and voltage
can be found using the following equation from the datasheet</p>
<p><span
class="math display"><em>C</em><sub><em>E</em><em>F</em><em>F</em></sub> = <em>C</em><sub><em>N</em><em>O</em><em>M</em></sub>(1−<em>δ</em><sub><em>T</em><em>E</em><em>M</em><em>P</em></sub>)(1−<em>δ</em><sub><em>B</em><em>I</em><em>A</em><em>S</em></sub>)(1−<em>δ</em><sub><em>T</em><em>O</em><em>L</em></sub>)</span></p>
<p>where <span
class="math inline"><em>C</em><sub><em>E</em><em>F</em><em>F</em></sub></span>
is the effective capacitance at the specified operating voltage, <span
class="math inline"><em>C</em><sub><em>N</em><em>O</em><em>M</em></sub></span>
is the nominal datasheet capacitance, <span
class="math inline"><em>δ</em><sub><em>T</em><em>E</em><em>M</em><em>P</em></sub></span>
is the worst-case capacitor temperature derating coefficient, <span
class="math inline"><em>δ</em><sub><em>B</em><em>I</em><em>A</em><em>S</em></sub></span>
is the DC bias derating at the specified output voltage, and <span
class="math inline"><em>δ</em><sub><em>T</em><em>O</em><em>L</em></sub></span>
is the worst-case component tolerance.</p>
<p>The datasheet suggests a value of <span
class="math inline">10<em>μ</em><em>F</em></span> as a compromise
between performance and size - a value of <span
class="math inline">22<em>μ</em><em>F</em></span> was selected to
provide additional filtering without compromising performance by a large
amount. This value will provide extremely comfortable margins at the
worst-case values determined above, and will provide better filtering
than the recommended value with better response time. Thus,</p>
<p><span
class="math display"><em>C</em><sub><em>O</em><em>U</em><em>T</em><sub>+</sub></sub> = <em>C</em><sub><em>O</em><em>U</em><em>T</em><sub>−</sub></sub> = 22<em>μ</em><em>F</em></span></p>
</section>
<div class="cell code" data-execution_count="19">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>C_OUT <span class="op">=</span> <span class="fl">20E-6</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>D_TEMP <span class="op">=</span> <span class="fl">0.014</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>D_BIAS <span class="op">=</span> <span class="fl">0.120</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>D_TOL <span class="op">=</span> <span class="fl">0.200</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>C_OUT_ESR <span class="op">=</span> <span class="fl">2.5E-3</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>C_OUT_EFF <span class="op">=</span> C_OUT <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> D_TEMP ) <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> D_BIAS ) <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> D_TOL )</span></code></pre></div>
</div>
<section id="input-capacitors" class="cell markdown">
<h4>Input Capacitors</h4>
<p>Larger value input capacitors reduce input voltage ripple and improve
transient response of the system. Component placement should be
optimized to minimize supply noise by placing the input capacitors as
close as possible to the power input pins. For stability, and effective
capacitance of at least <span
class="math inline">10<em>μ</em><em>F</em></span> is required, with a
minimum of <span class="math inline">5.6<em>μ</em><em>F</em></span>
required for the PVIN1 and PVIN2 pins and <span
class="math inline">3.3<em>μ</em><em>F</em></span> required for the
PVINSYS pin.</p>
<p>To minimize the number of componentes in the BOM, the same <span
class="math inline">22<em>μ</em><em>F</em></span> capacitor will be used
to decouple the power input pins - one for PVIN1 and PVIN2 and another
for PVINSYS.</p>
</section>
<div class="cell code" data-execution_count="20">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>C_PVIN <span class="op">=</span> <span class="fl">22E-6</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>C_PVINSYS <span class="op">=</span> <span class="fl">22E-6</span></span></code></pre></div>
</div>
<section id="v_reg-capacitor" class="cell markdown">
<h4><span
class="math inline"><em>V</em><sub><em>R</em><em>E</em><em>G</em></sub></span>
Capacitor</h4>
<p>The datasheet requires a <span
class="math inline">1.0<em>μ</em><em>F</em></span> ceramic capacitor
between the VREG pin and AGND.</p>
</section>
<div class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>C_VREG <span class="op">=</span> <span class="fl">1E-6</span></span></code></pre></div>
</div>
<section id="v_ref-capacitor" class="cell markdown">
<h4><span
class="math inline"><em>V</em><sub><em>R</em><em>E</em><em>F</em></sub></span>
Capacitor</h4>
<p>The datasheet requires a <span
class="math inline">1.0<em>μ</em><em>F</em></span> ceramic capacitor
between the VREF pin and AGND.</p>
</section>
<div class="cell code" data-execution_count="22">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>C_VREG <span class="op">=</span> <span class="fl">1E-6</span></span></code></pre></div>
</div>
<section id="soft-start-resistor" class="cell markdown">
<h4>Soft Start Resistor</h4>
<p>Soft start is not a required feature, but it can be implemented and
the resistor DNP'ed to save on cost if desired. The plot below shows the
relationship between the soft start time and the value of the timing
resistor. A resistor value of <span
class="math inline">71.5<em>k</em><em>Ω</em></span> yields a soft start
time of approximately <span
class="math inline">29<em>m</em><em>s</em></span> and is already being
used in the circuit as <span
class="math inline"><em>R</em><sub><em>F</em><em>B</em>2</sub></span>.</p>
<p><img src="ADP5070_ss_resistor_plot.png"
alt="ADP5070_ss_resistor_plot.png" /></p>
</section>
<div class="cell code" data-execution_count="23">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>R_SOFT_START <span class="op">=</span> np.linspace(<span class="fl">50E3</span>, <span class="fl">268E3</span>, <span class="dv">800</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>t_SOFT_START <span class="op">=</span> <span class="fl">38.4E-3</span> <span class="op">-</span> <span class="fl">1.28E-7</span> <span class="op">*</span> R_SOFT_START</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>ax.plot(R_SOFT_START, t_SOFT_START, label<span class="op">=</span><span class="st">&#39;Soft Start Resistor Values&#39;</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>R_SOFT_START <span class="op">=</span> <span class="fl">71.5E3</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>t_SOFT_START <span class="op">=</span> <span class="fl">38.4E-3</span> <span class="op">-</span> <span class="fl">1.28E-7</span> <span class="op">*</span> R_SOFT_START</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>ax.plot(R_SOFT_START, t_SOFT_START, <span class="st">&#39;.&#39;</span>, label<span class="op">=</span><span class="st">&#39;Selected Resistance&#39;</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(formatter_s)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(formatter_Ohm)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Timing Resistor Value vs. Soft Start Time&quot;</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">&quot;Power Supply Soft Start&quot;</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="output display_data">
<p><img src="ca43374f6b6b1cbcc8417490641fbc7078201c6e.png" /></p>
</div>
</div>
<section id="diodes" class="cell markdown">
<h4>Diodes</h4>
<p>A low forward voltage Schottky diode with less than <span
class="math inline">40<em>p</em><em>F</em></span> junction capacitance
is recommended for D1 and D2. The selected diode, the Diodes
Incorporated DFLS240L-7, has a typical forward voltage <span
class="math inline"><em>V</em><sub><em>D</em><em>F</em></sub> = 450<em>m</em><em>V</em></span>
and a typical junction capacitance of <span
class="math inline">90<em>p</em><em>F</em></span>. This capacitance is
higher than recommended, but the efficiency losses will be minimal.</p>
</section>
<div class="cell code" data-execution_count="24">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>V_DF <span class="op">=</span> <span class="fl">450E-3</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>C_D <span class="op">=</span> <span class="fl">90E-12</span></span></code></pre></div>
</div>
<section id="boost-regulator-inductor" class="cell markdown">
<h4>Boost Regulator Inductor</h4>
<p>The datasheet recommends an inductor value between <span
class="math inline">1<em>μ</em><em>H</em></span> and <span
class="math inline">22<em>μ</em><em>H</em></span> as a good compromise
between inductor current ripple and efficiency. The inductor ripple
current in the worst-case, the continuous conduction mode, can be
calculated. The switch duty cycle, <span
class="math inline"><em>D</em><em>U</em><em>T</em><em>Y</em><sub>1</sub></span>,
can be found from the relationship below.</p>
<p><span class="math display">$$ DUTY_1 = \left( \frac{V_{POS} - V_{IN}
+ V_{DF}}{V_{POS} + V_{DF}} \right)$$</span></p>
<p>The DC input current during the constant current mode can be found
from the equation below.</p>
<p><span class="math display">$$ I_{IN} = \frac{I_{OUT1}}{1 -
DUTY_1}$$</span></p>
<p>Using the duty cycle and switching frequency, the switch on time can
be obtained as follows. The switching frequency is chosen here to be
either <span
class="math inline">1.2<em>M</em><em>H</em><em>z</em></span> or <span
class="math inline">2.4<em>M</em><em>H</em><em>z</em></span>.</p>
<p><span class="math display">$$ t_{ON1} = \frac{DUTY_1}{f_{SW}}
$$</span></p>
<p>Finally, the on time is then used to find the inductor size as a
function of inductor ripple current at steady-state.</p>
<p><span class="math display">$$ L1 = \frac{V_{IN}t_{ON1}}{\Delta
I_{L1}} $$</span></p>
<p>Assuming inductor ripple current of 30% the maximum DC input current
yields the following expression.</p>
<p><span class="math display">$$ L1 =
\frac{V_{IN}t_{ON1}\left(1-DUTY_1\right)}{0.3I_{OUT_1}} $$</span></p>
<p>To ensure stability, the minimum inductance is given by the below
equation from the datasheet.</p>
<p><span class="math display">$$ L1_{MIN} = V_{IN} \left(
\frac{0.27}{1-DUTY_1} - 0.33\right) \left[ \mu H\right]$$</span></p>
<p><img src="ADP5070_boost_inductor_chart.png"
alt="ADP5070_boost_inductor_chart.png" /></p>
</section>
<div class="cell code" data-execution_count="25">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>f_SW <span class="op">=</span> <span class="fl">2.4E6</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>DUTY_1 <span class="op">=</span> ( V_POS <span class="op">-</span> V_IN <span class="op">+</span> V_DF ) <span class="op">/</span> (V_POS <span class="op">+</span> V_DF)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>I_IN <span class="op">=</span> I_OUT1 <span class="op">/</span> ( <span class="dv">1</span> <span class="op">-</span> DUTY_1 )</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>t_ON1 <span class="op">=</span> DUTY_1 <span class="op">/</span> f_SW</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>L1 <span class="op">=</span> V_IN <span class="op">*</span> t_ON1 <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> DUTY_1) <span class="op">/</span> ( <span class="fl">0.3</span> <span class="op">*</span> I_OUT1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>L1_MIN <span class="op">=</span> <span class="fl">1E-6</span> <span class="op">*</span> V_IN <span class="op">*</span> ( ( <span class="fl">0.27</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> DUTY_1)) <span class="op">-</span> <span class="fl">0.33</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;L1 =&quot;</span>, L1)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;L1_MIN =&quot;</span>, L1_MIN)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>L1 = 1.2773080272898825e-05
L1_MIN = 5.399999999999998e-07
</code></pre>
</div>
</div>
<section id="inverting-regulator-inductor" class="cell markdown">
<h4>Inverting Regulator Inductor</h4>
<p>Similarly, the inductor value for the inverting regulator's inductor
can be derived. Again starting with the duty cycle, <span
class="math inline"><em>D</em><em>U</em><em>T</em><em>Y</em><sub>2</sub></span>
we obtain the following expression.</p>
<p><span class="math display">$$ DUTY_2 = \left( \frac{|V_{NEG}| +
V_{DF}}{V_{IN} + |V_{NEG}| + V_{DF}} \right) $$</span></p>
<p>The DC current in the constant current mode can then be found as a
function of the duty cycle.</p>
<p><span class="math display">$$ I_{L2} = \frac{I_{OUT2}}{1 - DUTY_2}
$$</span></p>
<p>The switch on time is also expressed as a function of the duty
cycle.</p>
<p><span class="math display">$$ t_{ON2} = \frac{DUTY_2}{f_{SW}}
$$</span></p>
<p>And again, the inductance value can be obtained from the on time and
the inductor ripple current.</p>
<p><span class="math display">$$ L2 = \frac{V_{IN}t_{ON2}}{\Delta
I_{L2}} $$</span></p>
<p>Again assuming a ripple current of <span
class="math inline">30%</span> the maximum DC current will allow the
expression to be solved as follows.</p>
<p><span class="math display">$$ L2 = \frac{V_{IN}t_{ON2}\left( 1 -
DUTY_2\right)}{0.3I_{OUT2}} $$</span></p>
<p>To ensure stability, the <span class="math inline"><em>L</em>2</span>
inductor value must be greater than the minimum inductance obtained
below.</p>
<p><span class="math display">$$ L2_{MIN} = V_{IN}\left( \frac{0.27}{1 -
DUTY_2} - 0.33\right) \left[ \mu H\right]$$</span></p>
<p><img src="ADP5070_inverter_inductor_chart.png"
alt="ADP5070_inverter_inductor_chart.png" /></p>
</section>
<div class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>DUTY_2 <span class="op">=</span> ( np.<span class="bu">abs</span>(V_NEG) <span class="op">+</span> V_DF ) <span class="op">/</span> ( V_IN <span class="op">+</span> np.<span class="bu">abs</span>(V_NEG) <span class="op">+</span> V_DF )</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>I_L2 <span class="op">=</span> I_OUT2 <span class="op">/</span> ( <span class="dv">1</span> <span class="op">-</span> DUTY_2 )</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>t_ON2 <span class="op">=</span> DUTY_2 <span class="op">/</span> f_SW</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>L2 <span class="op">=</span> V_IN <span class="op">*</span> t_ON2 <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> DUTY_2 ) <span class="op">/</span> ( <span class="fl">0.3</span> <span class="op">*</span> np.<span class="bu">abs</span>(I_OUT2) )</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>L2_MIN <span class="op">=</span> <span class="fl">1E-6</span> <span class="op">*</span> V_IN <span class="op">*</span> ( ( <span class="fl">0.27</span> <span class="op">/</span> ( <span class="dv">1</span> <span class="op">-</span> DUTY_2)) <span class="op">-</span> <span class="fl">0.33</span> )</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;L2 =&quot;</span>, L2)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;L2_MIN =&quot;</span>, L2_MIN)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>L2 = 1.4331792091836734e-05
L2_MIN = 2.8485000000000008e-06
</code></pre>
</div>
</div>
<section id="boost-regulator-compensation" class="cell markdown">
<h4>Boost Regulator Compensation</h4>
<p>The ADP5070 allows for external loop compensation to optimize the
dynamics for a given application. The design of the compensation network
for the boost regulator is performed following the datasheet
recommendations as follows.</p>
<p><img src="ADP5070_boost_compensator.png"
alt="ADP5070_boost_compensator.png" /></p>
<p>The boost regulator requires compensation such that the crossover
frequency occurs below the frequency of the right-half plane zero
introduced by the topology of the converter. The zero is can be
determined as shown,</p>
<p><span class="math display">$$ f_{Z1}(RHP) = \frac{R_{LOAD1}\left( 1 -
DUTY_1 \right)^2}{2\pi L1} $$</span></p>
<p>where <span
class="math inline"><em>f</em><sub><em>Z</em>1</sub>(<em>R</em><em>H</em><em>P</em>)</span>
is the right half plane zero frequency and <span
class="math inline"><em>R</em><sub><em>L</em><em>O</em><em>A</em><em>D</em>1</sub></span>
is the equivalent load resistance. The datasheet recommends that the
regulator crossover frequency be less than or equal to one-tenth the
right half plane zero frequency. The boost regulator loop gain is</p>
<p><span class="math display">$$ A_{VL1} =
\frac{V_{FB1}V_{IN}}{V_{POS}}G_{M1}|R_{OUT1}||Z_{COMP1}|G_{CS1}|Z_{OUT1}|
$$</span></p>
<p>where <span
class="math inline"><em>A</em><sub><em>V</em><em>L</em>1</sub></span> is
the loop gain, <span
class="math inline"><em>V</em><sub><em>F</em><em>B</em>1</sub></span> is
the feedback regulation voltage, <span
class="math inline"><em>V</em><sub><em>P</em><em>O</em><em>S</em></sub></span>
is the regulated positive output voltage, <span
class="math inline"><em>V</em><sub><em>I</em><em>N</em></sub></span> is
the input voltage, <span
class="math inline"><em>G</em><sub><em>M</em>1</sub></span> is the error
amplifier transconductance gain, <span
class="math inline"><em>R</em><sub><em>O</em><em>U</em><em>T</em>1</sub></span>
is the output impedance of the error amplifier and is <span
class="math inline">33<em>M</em><em>Ω</em></span>, <span
class="math inline"><em>Z</em><sub><em>C</em><em>O</em><em>M</em><em>P</em>1</sub></span>
is the impedance of the series RC network from <span
class="math inline"><em>C</em><em>O</em><em>M</em><em>P</em><sub>1</sub></span>
to <span
class="math inline"><em>A</em><em>G</em><em>N</em><em>D</em></span>,
<span
class="math inline"><em>G</em><sub><em>C</em><em>S</em>1</sub></span> is
the current sense transconductance gain (the inductor current divided by
the voltage at <span
class="math inline"><em>C</em><em>O</em><em>M</em><em>P</em><sub>1</sub></span>),
which is internally set by the ADP5070 to 6.25 A/V, and finally <span
class="math inline"><em>Z</em><sub><em>O</em><em>U</em><em>T</em>1</sub></span>
is the impedance of the load in parallel with the output capacitor.</p>
<p>To solve for the crossover frequency, the equation may be simplified
to</p>
<p><span class="math display">$$ A_{VL1} =
\frac{V_{FB1}V_{IN}}{V_{POS}}\frac{G_{M1}R_{C1}G_{CS1}}{2\pi
f_{C1}C_{OUT1}} = 1 $$</span></p>
<p>where <span
class="math inline"><em>f</em><sub><em>C</em>1</sub></span> is the
crossover frequency.</p>
<p>To solve for <span
class="math inline"><em>R</em><sub><em>C</em>1</sub></span>, the
datasheet provides the following equation, where <span
class="math inline"><em>G</em><sub><em>M</em>1</sub> = 6.25<em>A</em>/<em>V</em></span>.</p>
<p><span class="math display">$$ R_{C1} = \frac{2\pi
f_{C1}C_{OUT1}V_{POS}^2}{V_{FB1}V_{IN}G_{M1}G_{CS1}} $$</span></p>
<p>From the datasheet, this equation can be simplified.</p>
<p><span class="math display">$$ R_{C1} = \frac{4188
f_{C1}C_{OUT1}V_{POS}^2}{V_{IN}} $$</span></p>
<p>For best accuracy, the datasheet recommends using the effective
capacitance of the output capacitor under DC bias conditions that will
be seen in operation.</p>
<p>Once the compensation resistor has been found, the zero can be set to
one-fourth the crossover frequency, per the datasheet's
recommendation.</p>
<p><span class="math display">$$ C_{C1} = \frac{2}{\pi f_{C1}R_{C1}}
$$</span></p>
<p>The parallel capacitor is then chosen to cancel the zero introduced
by the output capacitor ESR.</p>
<p><span class="math display">$$ C_{B1} = \frac{R_{ESR}
C_{OUT1}}{R_{C1}} $$</span></p>
<p>From the datasheet, for most applications, <span
class="math inline"><em>R</em><sub><em>C</em>1</sub></span> must be
within the range of <span
class="math inline">1<em>k</em><em>Ω</em></span> to <span
class="math inline">200<em>k</em><em>Ω</em></span>, and <span
class="math inline"><em>C</em><sub><em>C</em>1</sub></span> must be
within the range of <span
class="math inline">1<em>n</em><em>F</em></span> to <span
class="math inline">68<em>n</em><em>F</em></span>.</p>
</section>
<div class="cell code" data-execution_count="27">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>R_LOAD1 <span class="op">=</span> V_POS <span class="op">/</span> I_OUT1</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>f_Z1_RHP <span class="op">=</span> ( R_LOAD1 <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> DUTY_1 )<span class="op">**</span><span class="dv">2</span> ) <span class="op">/</span> ( <span class="dv">2</span><span class="op">*</span>np.pi <span class="op">*</span> L1 )</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>f_C1 <span class="op">=</span> f_Z1_RHP <span class="op">*</span> <span class="fl">95E-3</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>V_FB1 <span class="op">=</span> V_POS <span class="op">*</span> R_FB1 <span class="op">/</span> ( R_FB1 <span class="op">+</span> R_FT1 )</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>G_M1 <span class="op">=</span> <span class="fl">300E-6</span> <span class="co"># from datasheet</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>G_CS1 <span class="op">=</span> <span class="fl">6.25</span> <span class="co"># from datasheet</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>R_C1 <span class="op">=</span> ( <span class="dv">2</span><span class="op">*</span>np.pi <span class="op">*</span> f_C1 <span class="op">*</span> C_OUT_EFF <span class="op">*</span> V_POS<span class="op">**</span><span class="dv">2</span> ) <span class="op">/</span> ( V_FB1 <span class="op">*</span> V_IN <span class="op">*</span> G_M1 <span class="op">*</span> G_CS1 )</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>C_C1 <span class="op">=</span> <span class="dv">2</span> <span class="op">/</span> ( np.pi <span class="op">*</span> f_C1 <span class="op">*</span> R_C1 )</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>C_B1 <span class="op">=</span> C_OUT_ESR <span class="op">*</span> C_OUT <span class="op">/</span> R_C1</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R_C1 =&quot;</span>, R_C1)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;C_C1 =&quot;</span>, C_C1)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;C_B1 =&quot;</span>, C_B1)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R_C1 = 32806.31335384616
C_C1 = 5.793350733506955e-10
C_B1 = 1.5240968852764458e-12
</code></pre>
</div>
</div>
<section id="inverting-regulator-compensation" class="cell markdown">
<h4>Inverting Regulator Compensation</h4>
<p>The design of the inverting regulator compensation network is similar
to that of the boost regulator compensation network. For the sake of
brevity, the detailed explanation has been omitted, but the process is
the same as above.</p>
</section>
<div class="cell code" data-execution_count="28">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>R_LOAD2 <span class="op">=</span> V_NEG <span class="op">/</span> I_OUT2</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>f_Z2_RHP <span class="op">=</span> ( R_LOAD2 <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> DUTY_2 )<span class="op">**</span><span class="dv">2</span> ) <span class="op">/</span> ( <span class="dv">2</span><span class="op">*</span>np.pi <span class="op">*</span> L2 <span class="op">*</span> DUTY_2 )</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>f_C2 <span class="op">=</span> f_Z2_RHP <span class="op">*</span> <span class="fl">95E-3</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>V_FB2 <span class="op">=</span> V_NEG <span class="op">*</span> R_FT2 <span class="op">/</span> ( R_FB2 <span class="op">+</span> R_FT2 )</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>G_M2 <span class="op">=</span> <span class="fl">300E-6</span> <span class="co"># from datasheet</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>G_CS2 <span class="op">=</span> <span class="fl">6.25</span> <span class="co"># from datasheet</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>R_C2 <span class="op">=</span> ( <span class="dv">2</span><span class="op">*</span>np.pi <span class="op">*</span> f_C2 <span class="op">*</span> C_OUT_EFF <span class="op">*</span> np.<span class="bu">abs</span>(V_NEG) <span class="op">*</span> ( V_IN <span class="op">+</span> ( <span class="dv">2</span> <span class="op">*</span> np.<span class="bu">abs</span>(V_NEG) ) ) ) <span class="op">/</span> ( np.<span class="bu">abs</span>(V_FB2) <span class="op">*</span> V_IN <span class="op">*</span> G_M2 <span class="op">*</span> G_CS2 )</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>C_C2 <span class="op">=</span> <span class="dv">2</span> <span class="op">/</span> ( np.pi <span class="op">*</span> f_C2 <span class="op">*</span> R_C2 )</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>C_B2 <span class="op">=</span> C_OUT_ESR <span class="op">*</span> C_OUT <span class="op">/</span> R_C2</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R_C2 =&quot;</span>, R_C2)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;C_C2 =&quot;</span>, C_C2)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;C_B2 =&quot;</span>, C_B2)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R_C2 = 3330.504725701844
C_C2 = 1.0800204962904543e-08
C_B2 = 1.5012739544893877e-11
</code></pre>
</div>
</div>
